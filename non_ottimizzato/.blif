.model DATAPATH
.inputs BYPASS S RESETSBARRA IN OUT SECTOR2 SECTOR1 SECTOR0
.outputs OCOMP3 FSECTOR1 FSECTOR2 FSECTOR3 SBARRAIN SBARRAOUT #COMP1 OCOMP2 OCOMP3#OCOMP uguaglianze per scegliere il registro sono uguaglianze


.names S C1
- 1

.names S C0
- 0


#IMPORTANTE SENNÒ CREA UN CICLO NELLA FSMD
#DAL LATCH FACCIAMO USCIRE UN 1
.latch S A re NIL 1

#MUX A DUE BIT IL VALORE IN USCITA VERRà CONTROLLATO SE è UGUALE A 1/2/3
.subckt MUX2 A1=C0 A0=C0 B1=OREG1 B0=OREG0 S=A O1=o1 O0=o0



#CONTROLLA SE è UGUALE A 1. SARÀ IL SELETTORE DEL PROSSIMO MUX
.subckt UGUALE2 A1=o1 A0=o0 B1=C0 B0=C1 O=OCOMP1

#CONTROLLA SE è UGUALE A 2.SARÀ IL SELETTORE DEL PROSSIMO MUX
.subckt UGUALE2 A1=o1 A0=o0 B1=C1 B0=C0 O=OCOMP2

#CONTROLLA SE è UGUALE A 3, SARÀ IL SELETTORE DEL PROSSIMO MUX
.subckt UGUALE2 A1=o1 A0=o0 B1=C1 B0=C1 O=OCOMP3


#SOMMO IL VALORE USCITO DAL MULTIPLEX CON IL RISULTATO DELLUGUAGLIANZA
.subckt SOMMATORE2 A1=o1 A0=o0 B1=C0 B0=C1 CIN=CIN O1=r1 O0=r0 COUT=COUT

#SALVO IL VALORE, INGRESSO DEL MUX INIZIALE 
.subckt REGISTRO2 A1=r1 A0=r0 O1=OREG1 O0=OREG0

#fine prima parte

#Zona Verde #finito il ciclo operatore
#controllo se abbiamo inserito il primo settore
.subckt UGUALE3 A2=C1 A1=C0 A0=C0 B2=SECTOR2 B1=SECTOR1 B0=SECTOR0 O=out1
#controllo se abbiamo inserito il secondo settore
.subckt UGUALE3 A2=C0 A1=C1 A0=C0 B2=SECTOR2 B1=SECTOR1 B0=SECTOR0 O=out2
#controllo se abbiamo inserito il terzo settore
.subckt UGUALE3 A2=C0 A1=C0 A0=C1 B2=SECTOR2 B1=SECTOR1 B0=SECTOR0 O=out3
                



#seleziona se nel primo registro deve entrare il numero di auto della modalità operatore o la somma di 1
.subckt MUX5 A4=IN A3=OUT A2=SECTOR2 A1=SECTOR1 A0=SECTOR0 B4=OUTLMUX14 B3=OUTLMUX13 B2=OUTLMUX12 B1=OUTLMUX11 B0=OUTLMUX10 S=OCOMP1 O4=OUTMUXREG14 O3=OUTMUXREG13 O2=OUTMUXREG12 O1=OUTMUXREG11 O0=OUTMUXREG10
#seleziona se nel secondo registro deve entrare il numero di auto della modalità operatore o la somma di 1
.subckt MUX5 A4=IN A3=OUT A2=SECTOR2 A1=SECTOR1 A0=SECTOR0 B4=OUTLMUX24 B3=OUTLMUX23 B2=OUTLMUX22 B1=OUTLMUX21 B0=OUTLMUX20 S=OCOMP2 O4=OUTMUXREG24 O3=OUTMUXREG23 O2=OUTMUXREG22 O1=OUTMUXREG21 O0=OUTMUXREG20
#seleziona se nel primo registro deve entrare il numero di auto della modalità operatore o la somma di 1
.subckt MUX5 A4=IN A3=OUT A2=SECTOR2 A1=SECTOR1 A0=SECTOR0 B4=OUTLMUX34 B3=OUTLMUX33 B2=OUTLMUX32 B1=OUTLMUX31 B0=OUTLMUX30 S=OCOMP3 O4=OUTMUX34 O3=OUTMUX33 O2=OUTMUX32 O1=OUTMUX31 O0=OUTMUX30

#si attiva solo se gli altri registri sono spenti
.subckt CLOCK1 A=OCOMP1 B=out1 C=OCOMP2 D=OCOMP3 E=BYPASS CLOCK1=CLOCK1
.subckt CLOCK1 A=OCOMP2 B=out2 C=OCOMP1 D=OCOMP3 E=BYPASS CLOCK1=CLOCK2
.subckt CLOCK1 A=OCOMP3 B=out3 C=OCOMP1 D=OCOMP2 E=BYPASS CLOCK1=CLOCK3

#CONTROLLA SE I SETTORI 1 E 2 SONO PIENI 31 = 11111 QUINDI È SUFICIENTE UN AND
.subckt AND5 A=OUTMUXREG141 B=OUTMUXREG131 C=OUTMUXREG121 D=OUTMUXREG111 E=OUTMUXREG101 O=FSECTOR1
.subckt AND5 A=OUTMUXREG242 B=OUTMUXREG232 C=OUTMUXREG222 D=OUTMUXREG212 E=OUTMUXREG202 O=FSECTOR2


#SE I DUE BIT PIÙ SIGNIFICATIVI DEL NUMERO DI AUTO INSERITE SONO 1 1 ALLORA SI È RAGGIUNTO LA CIFRA MASSIMA. 24 = 1 1 0 0 0
.subckt AND2 A=OUTMUX343 B=OUTMUX333 O=FSECTOR3

#SE DAL CONTROLLO PRECEDENTE RISULTA UN NUMERO MAGGIORE/UGUALE A 24 il mux FA USCIRE LA COSTANTE 24
.subckt MUX5 A4=C1 A3=C1 A2=C0 A1=C0 A0=C0 B4=OUTMUX343 B3=OUTMUX333 B2=OUTMUX323 B1=OUTMUX313 B0=OUTMUX303 S=FSECTOR3 O4=OUTMUXREG34 O3=OUTMUXREG33 O2=OUTMUXREG32 O1=OUTMUXREG31 O0=OUTMUXREG30


.subckt MUX5 A4=C0 A3=C0 A2=C0 A1=C0 A0=C0 B4=OUTMUXREG14 B3=OUTMUXREG13 B2=OUTMUXREG12 B1=OUTMUXREG11 B0=OUTMUXREG10 S=BYPASS O4=OUTMUXREG141 O3=OUTMUXREG131 O2=OUTMUXREG121 O1=OUTMUXREG111  O0=OUTMUXREG101
.subckt MUX5 A4=C0 A3=C0 A2=C0 A1=C0 A0=C0 B4=OUTMUXREG24 B3=OUTMUXREG23 B2=OUTMUXREG22 B1=OUTMUXREG21 B0=OUTMUXREG20 S=BYPASS O4=OUTMUXREG242 O3=OUTMUXREG232 O2=OUTMUXREG222 O1=OUTMUXREG212  O0=OUTMUXREG202
.subckt MUX5 A4=C0 A3=C0 A2=C0 A1=C0 A0=C0 B4=OUTMUX34 B3=OUTMUX33 B2=OUTMUX32 B1=OUTMUX31 B0=OUTMUX30 S=BYPASS O4=OUTMUX343 O3=OUTMUX333 O2=OUTMUX323 O1=OUTMUX313  O0=OUTMUX303

#i tre registri
.subckt REGCLOCK5  A4=OUTMUXREG141 A3=OUTMUXREG131 A2=OUTMUXREG121 A1=OUTMUXREG111 A0=OUTMUXREG101 CLOCK=CLOCK1 O4=OUTREG14 O3=OUTREG13 O2=OUTREG12 O1=OUTREG11 O0=OUTREG10
.subckt REGCLOCK5  A4=OUTMUXREG242 A3=OUTMUXREG232 A2=OUTMUXREG222 A1=OUTMUXREG212 A0=OUTMUXREG202 CLOCK=CLOCK2 O4=OUTREG24 O3=OUTREG23 O2=OUTREG22 O1=OUTREG21 O0=OUTREG20
.subckt REGCLOCK5  A4=OUTMUXREG34 A3=OUTMUXREG33 A2=OUTMUXREG32 A1=OUTMUXREG31 A0=OUTMUXREG30 CLOCK=CLOCK3 O4=OUTREG34 O3=OUTREG33 O2=OUTREG32 O1=OUTREG31 O0=OUTREG30

#seleziona se sottrarre o sommare
.subckt CONSTSELECTOR1 S1=IN S0=OUT S=CLOCK1 O4=CONSTSELECTOR41 O3=CONSTSELECTOR31 O2=CONSTSELECTOR21 O1=CONSTSELECTOR11 O0=CONSTSELECTOR01 #x reg1
.subckt CONSTSELECTOR1 S1=IN S0=OUT S=CLOCK2 O4=CONSTSELECTOR42 O3=CONSTSELECTOR32 O2=CONSTSELECTOR22 O1=CONSTSELECTOR12 O0=CONSTSELECTOR02 #x reg 2
.subckt CONSTSELECTOR1 S1=IN S0=OUT S=CLOCK3 O4=CONSTSELECTOR43 O3=CONSTSELECTOR33 O2=CONSTSELECTOR23 O1=CONSTSELECTOR13 O0=CONSTSELECTOR03 #x reg 3

#sommatore o sottrare in complemento2 reg1
.subckt SOMMATORE5 A4=OUTREG14 A3=OUTREG13 A2=OUTREG12 A1=OUTREG11 A0=OUTREG10 B4=CONSTSELECTOR41 B3=CONSTSELECTOR31 B2=CONSTSELECTOR21 B1=CONSTSELECTOR11 B0=CONSTSELECTOR01 CIN=CIN O4=SUMOUT41 O3=SUMOUT31 O2=SUMOUT21 O1=SUMOUT11 O0=SUMOUT01 COUT=COUT1
.subckt SOMMATORE5 A4=OUTREG24 A3=OUTREG23 A2=OUTREG22 A1=OUTREG21 A0=OUTREG20 B4=CONSTSELECTOR42 B3=CONSTSELECTOR32 B2=CONSTSELECTOR22 B1=CONSTSELECTOR12 B0=CONSTSELECTOR02 CIN=CIN O4=SUMOUT42 O3=SUMOUT32 O2=SUMOUT22 O1=SUMOUT12 O0=SUMOUT02 COUT=COUT2
.subckt SOMMATORE5 A4=OUTREG34 A3=OUTREG33 A2=OUTREG32 A1=OUTREG31 A0=OUTREG30 B4=CONSTSELECTOR43 B3=CONSTSELECTOR33 B2=CONSTSELECTOR23 B1=CONSTSELECTOR13 B0=CONSTSELECTOR03 CIN=CIN O4=SUMOUT43 O3=SUMOUT33 O2=SUMOUT23 O1=SUMOUT13 O0=SUMOUT03 COUT=COUT3

#SELETTORE PARZIALE MUXFINALE PRIMO REGISTRO
.subckt SELETTOREPARZIALE A4=OUTREG14 A3=OUTREG13 A2=OUTREG12 A1=OUTREG11 A0=OUTREG10 B4=SUMOUT41 B3=SUMOUT31 B2=SUMOUT21 B1=SUMOUT11 B0=SUMOUT01 SELECTORLMUXP1=SELECTORLMUXP11
.subckt SELETTOREPARZIALEINVERTITO A4=OUTREG14 A3=OUTREG13 A2=OUTREG12 A1=OUTREG11 A0=OUTREG10 B4=SUMOUT41 B3=SUMOUT31 B2=SUMOUT21 B1=SUMOUT11 B0=SUMOUT01 SELECTORLMUXP0=SELECTORLMUXP10
#SELETTORE FINALE MUXFINALE PRIMO REGISTRO
.subckt OR A=SELECTORLMUXP11 B=SELECTORLMUXP10 O=SELECTORLMUX1

#SELETTORE PARZIALE MUXFINALE SECONDO REGISTRO
.subckt SELETTOREPARZIALE A4=OUTREG24 A3=OUTREG23 A2=OUTREG22 A1=OUTREG21 A0=OUTREG20 B4=SUMOUT42 B3=SUMOUT32 B2=SUMOUT22 B1=SUMOUT12 B0=SUMOUT02 SELECTORLMUXP1=SELECTORLMUXP21
.subckt SELETTOREPARZIALEINVERTITO A4=OUTREG24 A3=OUTREG23 A2=OUTREG22 A1=OUTREG21 A0=OUTREG20 B4=SUMOUT42 B3=SUMOUT32 B2=SUMOUT22 B1=SUMOUT12 B0=SUMOUT02 SELECTORLMUXP0=SELECTORLMUXP20
#SELETTORE FINALE MUXFINALE SECONDO REGISTRO
.subckt OR A=SELECTORLMUXP21 B=SELECTORLMUXP20 O=SELECTORLMUX2


.subckt AND2 A=SUMOUT43 B=SUMOUT33 O=oAND
.subckt OR3 A=SUMOUT23 B=SUMOUT13 C=SUMOUT03 O=oOR
.subckt AND2 A=oAND B=oOR O=SELECTORLMUX3


#l'uscitò si ricollega al primo mux iniziale
.subckt MUX5 A4=OUTREG14 A3=OUTREG13 A2=OUTREG12 A1=OUTREG11 A0=OUTREG10 B4=SUMOUT41 B3=SUMOUT31 B2=SUMOUT21 B1=SUMOUT11 B0=SUMOUT01 S=SELECTORLMUX1 O4=OUTLMUX14 O3=OUTLMUX13 O2=OUTLMUX12 O1=OUTLMUX11 O0=OUTLMUX10
#l'uscita si ricollega al secondo mux iniziale
.subckt MUX5 A4=OUTREG24 A3=OUTREG23 A2=OUTREG22 A1=OUTREG21 A0=OUTREG20 B4=SUMOUT42 B3=SUMOUT32 B2=SUMOUT22 B1=SUMOUT12 B0=SUMOUT02 S=SELECTORLMUX2 O4=OUTLMUX24 O3=OUTLMUX23 O2=OUTLMUX22 O1=OUTLMUX21 O0=OUTLMUX20
#DEVO COLLEGARLO AL MUX5 INIZIALE
.subckt MUX5 A4=OUTREG34 A3=OUTREG33 A2=OUTREG32 A1=OUTREG31 A0=OUTREG30 B4=SUMOUT43 B3=SUMOUT33 B2=SUMOUT23 B1=SUMOUT13 B0=SUMOUT03 S=SELECTORLMUX3 O4=OUTLMUX34 O3=OUTLMUX33 O2=OUTLMUX32 O1=OUTLMUX31 O0=OUTLMUX30
 
.subckt SBARRAINOUT BYPASS=BYPASS RESETSBARRA=RESETSBARRA OCOMP1=OCOMP1 OCOMP2=OCOMP2 OCOMP3=OCOMP3 CLOCK3=CLOCK3 CLOCK2=CLOCK2 CLOCK1=CLOCK1 SELECTORLMUX1=SELECTORLMUX1 SELECTORLMUX2=SELECTORLMUX2 SELECTORLMUX3=SELECTORLMUX3 IN=IN OUT=OUT   SBARRAIN=SBARRAIN SBARRAOUT=SBARRAOUT




.search reg2.blif
.search mux2.blif
.search sommatore2.blif
.search maggioreuguale.blif
.search demux.blif
.search comparatore3.blif
.search or.blif
.search regclock5.blif
.search clock1.blif
.search and2.blif
.search and5.blif
.search sommatore5.blif
.search constselector.blif
.search xnor5.blif
.search mux5.blif
.search selettoreparziale.blif
.search selettoreparzialeinvertito.blif
.search or3.blif
.search regclock1.blif
.search constselector1.blif
.search sbarrainout.blif










.end
